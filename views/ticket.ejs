<!doctype html>
<html lang="es" data-theme="light">
<head>
    <%- include('partials/head') %>
    <title>Ticket</title>

    <style>
        .ticket-card{
            background: var(--card);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            border-radius: 22px;
            overflow: hidden;
        }
        .ticket-top{
            padding: 18px 18px 12px;
            background:
                    radial-gradient(1000px 520px at 10% 0%, rgba(106,15,31,.20), transparent 55%),
                    radial-gradient(800px 420px at 90% 10%, rgba(106,15,31,.10), transparent 60%);
            border-bottom: 1px solid var(--border);
        }
        .ticket-body{ padding: 18px; }

        .pill{
            display:inline-flex; align-items:center; gap:.5rem;
            padding:.45rem .75rem; border-radius:999px;
            border:1px solid var(--border);
            background: var(--chip-bg);
            color: var(--chip-text);
            font-weight:600; font-size:.9rem;
            white-space:nowrap;
        }
        .title{
            letter-spacing:-.02em;
            font-weight:650;
            margin:0;
        }
        .meta{ color: var(--muted); font-size:.92rem; }

        .kv{
            list-style:none; padding:0; margin:0;
            display:grid; gap:.55rem;
        }
        .kv li{
            display:flex; justify-content:space-between; gap:12px;
            padding:.55rem .7rem;
            border:1px solid var(--border);
            border-radius:14px;
            background: color-mix(in srgb, var(--card) 86%, transparent);
        }
        .kv .k{ color: var(--muted); font-weight:500; }
        .kv .v{ font-weight:500; color: var(--text); text-align:right; }

        /* QR */
        .qr-wrap{
            border:1px solid var(--border);
            background: color-mix(in srgb, var(--card) 82%, transparent);
            border-radius:18px;
            padding:14px;
            display:inline-block;

            /* overlay icon */
            position: relative;
        }

        /* Auto encima del QR (no rompe el QR) */
        .qr-badge{
            position: absolute;
            right: 10px;
            bottom: 10px;
            width: 42px;
            height: 42px;
            border-radius: 14px;
            display: grid;
            place-items: center;

            background: color-mix(in srgb, var(--card) 88%, transparent);
            border: 1px solid var(--border);
            box-shadow: 0 10px 22px rgba(0,0,0,.12);

            font-size: 20px;
            line-height: 1;
            user-select: none;
        }

        .btn-xs{
            padding:.45rem .7rem;
            border-radius:12px;
            font-weight:600;
            font-size:.9rem;
        }
        .btn-ghost{
            border:1px solid var(--border);
            background:transparent;
            color: var(--text);
        }
        .btn-ghost:hover{
            border-color: color-mix(in srgb, var(--wine) 40%, var(--border));
            background: color-mix(in srgb, var(--card) 70%, transparent);
            color: var(--text);
        }

        .url-box{
            border:1px solid var(--border);
            background: color-mix(in srgb, var(--card) 86%, transparent);
            border-radius:16px;
            padding:10px 12px;
            display:flex; gap:10px;
            align-items:center;
            justify-content:space-between;
        }
        .mono{
            font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono","Courier New", monospace;
            font-size:.9rem;
            color: var(--muted);
            overflow:hidden;
            text-overflow:ellipsis;
            white-space:nowrap;
        }
    </style>
</head>

<body>
<nav class="navbar navbar-dark app-navbar">
    <div class="container d-flex justify-content-between align-items-center">
        <a class="navbar-brand d-flex align-items-center gap-2" href="/">
            <span class="brand-dot"></span>
            <span class="fw-semibold">TransportApp</span>
        </a>

        <div class="d-flex align-items-center gap-2">
            <button id="themeToggle" class="theme-btn" type="button" aria-label="Cambiar tema">
                <span id="themeIcon">ðŸŒ™</span> <span class="d-none d-sm-inline">Tema</span>
            </button>
        </div>
    </div>
</nav>

<main class="container py-4">

    <div class="ticket-card">
        <div class="ticket-top">
            <div class="d-flex flex-wrap justify-content-between align-items-start gap-3">
                <div>
                    <div class="pill">Ticket pagado</div>
                    <h1 class="h3 title mt-2">Folio: <span style="color: var(--wine);"><%= folio %></span></h1>
                    <div class="meta">CÃ³digo: <span style="color: var(--text);"><%= row.code %></span></div>
                </div>

                <div class="d-flex gap-2">
                    <a class="btn btn-wine btn-xs" href="/ticket/<%= row.code %>/pdf">PDF</a>
                    <a class="btn btn-ghost btn-xs" href="<%= returnUrl || '/' %>">Volver</a>
                </div>
            </div>
        </div>

        <div class="ticket-body">
            <div class="row g-4 align-items-start">
                <div class="col-lg-7">
                    <ul class="kv">
                        <li><span class="k">Ruta</span><span class="v"><%= directionLabel(row.direction) %></span></li>
                        <li><span class="k">Fecha</span><span class="v"><%= row.trip_date %></span></li>
                        <li><span class="k">Hora</span><span class="v"><%= row.depart_time %></span></li>

                        <li><span class="k">Contacto</span><span class="v"><%= row.customer_name %></span></li>
                        <li><span class="k">TelÃ©fono</span><span class="v"><%= row.phone %></span></li>

                        <li>
                            <span class="k">Servicio</span>
                            <span class="v"><%= row.type === "PASSENGER" ? "Pasajeros" : "PaqueterÃ­a / Mandado" %></span>
                        </li>

                        <% if (row.type === "PASSENGER") { %>
                            <li><span class="k">Pasajeros</span><span class="v"><%= row.passenger_names || "-" %></span></li>
                        <% } %>

                        <% if (row.type === "PACKAGE") { %>
                            <li><span class="k">Detalle</span><span class="v"><%= row.package_details || "-" %></span></li>
                        <% } %>
                    </ul>
                </div>

                <div class="col-lg-5 text-center">
                    <div class="qr-wrap">
                        <img src="<%= qrDataUrl %>" style="max-width:210px;" alt="QR"/>
                        <div class="qr-badge" title="TransportApp">ðŸš—</div>
                    </div>
                    <div class="meta mt-2">Escanea para validar</div>
                </div>
            </div>

            <div class="mt-4 url-box">
                <div class="d-flex flex-column text-start" style="min-width:0;">
                    <div class="meta">Link de validaciÃ³n</div>
                    <div class="mono" id="ticketUrl"><%= url %></div>
                </div>
                <button type="button" class="btn btn-ghost btn-xs" id="copyBtn">Copiar</button>
            </div>
        </div>
    </div>

</main>

<script src="/js/theme.js"></script>
<script>
    const btn = document.getElementById('copyBtn');
    btn?.addEventListener('click', async () => {
        const txt = document.getElementById('ticketUrl')?.innerText || '';
        try {
            await navigator.clipboard.writeText(txt);
            const old = btn.textContent;
            btn.textContent = 'Copiado';
            setTimeout(() => btn.textContent = old, 1500);
        } catch {
            alert('No pude copiar. Selecciona el link manualmente.');
        }
    });
</script>

</body>
</html>
